<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>hhçš„å…±äº«æ–‡ä»¶</title>
    <style>
        :root { --primary-color: #2563eb; --bg-color: #f1f5f9; }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg-color); margin: 0; padding: 15px; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 25px; border-radius: 16px; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }
        h1 { font-size: 1.5rem; color: #0f172a; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
        .file-list { list-style: none; padding: 0; margin: 0; }
        .file-item { display: flex; justify-content: space-between; align-items: center; padding: 14px; border-bottom: 1px solid #f1f5f9; border-radius: 8px; transition: all 0.2s; }
        .file-item:hover { background: #f8fafc; transform: translateX(5px); }
        .file-info { display: flex; flex-direction: column; overflow: hidden; }
        .file-name { font-weight: 500; color: #334155; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .file-size { font-size: 0.75rem; color: #94a3b8; }
        .actions { display: flex; gap: 10px; flex-shrink: 0; }
        .btn { padding: 6px 14px; border-radius: 8px; text-decoration: none; font-size: 0.85rem; font-weight: 600; transition: all 0.2s; }
        .btn-preview { background: #ecfdf5; color: #059669; border: 1px solid #10b981; }
        .btn-download { background: #eff6ff; color: #2563eb; border: 1px solid #3b82f6; }
        .btn:hover { filter: brightness(0.95); }
        .loading { text-align: center; color: #64748b; padding: 40px; }
    </style>
</head>
<body>

<div class="container">
    <h1 id="title">ğŸ“ æˆ‘çš„å…±äº«æ–‡ä»¶</h1>
    <ul id="file-list" class="file-list">
        <div class="loading">æ­£åœ¨æ‰«æä»“åº“ï¼Œè¯·ç¨å€™...</div>
    </ul>
</div>

<script>
    // ======= åŸŸåé…ç½® =======
    const API_DOMAIN = 'https://api.steveh1110.com'; // æ¥å£åŠé¢„è§ˆåŸŸå
    const NAS_DOMAIN = 'https://nas.steveh1110.com'; // çº¯ä¸‹è½½åŸŸå

    async function fetchFiles() {
        const urlParams = new URLSearchParams(window.location.search);
        const prefix = urlParams.get('prefix') || '';
        const listElement = document.getElementById('file-list');

        try {
            const response = await fetch(`${API_DOMAIN}?prefix=${encodeURIComponent(prefix)}`);
            if (!response.ok) throw new Error('ç½‘ç»œè¯·æ±‚å¼‚å¸¸');
            
            const data = await response.json();
            listElement.innerHTML = '';

            // 1. è¿”å›ä¸Šä¸€çº§é€»è¾‘
            if (prefix !== '') {
                const backLi = document.createElement('li');
                backLi.className = 'file-item';
                backLi.innerHTML = `<a href="?prefix=" style="color: var(--primary-color); text-decoration: none; font-weight: bold;">â¬…ï¸ è¿”å›æ ¹ç›®å½•</a>`;
                listElement.appendChild(backLi);
            }

            // 2. æ¸²æŸ“æ–‡ä»¶å¤¹ (åªæ˜¾ç¤ºæ–‡ä»¶å¤¹å)
            if (data.delimitedPrefixes) {
                data.delimitedPrefixes.forEach(folder => {
                    const parts = folder.split('/').filter(Boolean);
                    const folderName = parts[parts.length - 1];
                    
                    const li = document.createElement('li');
                    li.className = 'file-item';
                    li.innerHTML = `
                        <div class="file-info"><span class="file-name">ğŸ“ ${folderName}</span></div>
                        <div class="actions"><a href="?prefix=${encodeURIComponent(folder)}" class="btn btn-folder">æ‰“å¼€</a></div>
                    `;
                    listElement.appendChild(li);
                });
            }

            // 3. æ¸²æŸ“æ–‡ä»¶ (é¢„è§ˆèµ° APIï¼Œä¸‹è½½èµ° NAS)
            if (data.objects) {
                data.objects.forEach(file => {
                    if (file.key === prefix) return; 

                    const fileParts = file.key.split('/');
                    const fileName = fileParts[fileParts.length - 1];
                    
                    // å®šä¹‰ä¸åŒçš„é“¾æ¥
                    const previewUrl = `${API_DOMAIN}/${encodeURIComponent(file.key)}`;
                    const downloadUrl = `${NAS_DOMAIN}/${encodeURIComponent(file.key)}`;
                    const isPdf = file.key.toLowerCase().endsWith('.pdf');

                    const li = document.createElement('li');
                    li.className = 'file-item';
                    li.innerHTML = `
                        <div class="file-info">
                            <span class="file-name">ğŸ“„ ${fileName}</span>
                            <span class="file-size">${(file.size / 1024 / 1024).toFixed(2)} MB</span>
                        </div>
                        <div class="actions">
                            ${isPdf ? `<a href="${previewUrl}" target="_blank" class="btn btn-preview">é¢„è§ˆ</a>` : ''}
                            <a href="${downloadUrl}" download class="btn btn-download">ä¸‹è½½</a>
                        </div>
                    `;
                    listElement.appendChild(li);
                });
            }

            if (listElement.innerHTML === '') {
                listElement.innerHTML = '<div class="loading">æ­¤ç›®å½•ä¸ºç©º</div>';
            }

        } catch (error) {
            listElement.innerHTML = `<div class="loading" style="color: #ef4444;">åŠ è½½å¤±è´¥: ${error.message}</div>`;
        }
    }

    fetchFiles();
</script>

</body>
</html>