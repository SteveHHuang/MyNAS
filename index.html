<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>hhçš„å…±äº«æ–‡ä»¶</title>
    <style>
        :root { --primary-color: #2563eb; --bg-color: #f1f5f9; }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg-color); margin: 0; padding: 15px; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 25px; border-radius: 16px; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }
        h1 { font-size: 1.5rem; color: #0f172a; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
        .file-list { list-style: none; padding: 0; margin: 0; }
        .file-item { display: flex; justify-content: space-between; align-items: center; padding: 14px; border-bottom: 1px solid #f1f5f9; border-radius: 8px; transition: all 0.2s; }
        .file-item:hover { background: #f8fafc; transform: translateX(5px); }
        .file-info { display: flex; flex-direction: column; overflow: hidden; }
        .file-name { font-weight: 500; color: #334155; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .file-size { font-size: 0.75rem; color: #94a3b8; }
        .actions { display: flex; gap: 10px; flex-shrink: 0; }
        .btn { padding: 6px 14px; border-radius: 8px; text-decoration: none; font-size: 0.85rem; font-weight: 600; transition: all 0.2s; }
        .btn-preview { background: #ecfdf5; color: #059669; border: 1px solid #10b981; }
        .btn-download { background: #eff6ff; color: #2563eb; border: 1px solid #3b82f6; }
        .btn:hover { filter: brightness(0.95); }
        .loading { text-align: center; color: #64748b; padding: 40px; }
    </style>
</head>
<body>

<div class="container">
    <h1 id="title">ğŸ“ æˆ‘çš„å…±äº«æ–‡ä»¶</h1>
    <ul id="file-list" class="file-list">
        <div class="loading">æ­£åœ¨æ‰«æä»“åº“ï¼Œè¯·ç¨å€™...</div>
    </ul>
</div>

<script>
    const API_URL = 'https://api.steveh1110.com';

    async function fetchFiles() {
        const urlParams = new URLSearchParams(window.location.search);
        const prefix = urlParams.get('prefix') || '';
        const listElement = document.getElementById('file-list');

        try {
            // è®¿é—®è½»é‡åŒ–åçš„ Worker æ¥å£
            const response = await fetch(`${API_URL}?prefix=${encodeURIComponent(prefix)}`);
            if (!response.ok) throw new Error('API å“åº”å¼‚å¸¸');
            
            const data = await response.json();
            listElement.innerHTML = '';

            // 1. è¿”å›ä¸Šä¸€çº§
            if (prefix !== '') {
                const backLi = document.createElement('li');
                backLi.className = 'file-item';
                backLi.innerHTML = `<a href="?prefix=" style="color: var(--primary-color); text-decoration: none; font-weight: bold;">â¬…ï¸ è¿”å›æ ¹ç›®å½•</a>`;
                listElement.appendChild(backLi);
            }

            // 2. æ¸²æŸ“æ–‡ä»¶å¤¹ (æ¸…ç†å‰ç¼€)
            if (data.delimitedPrefixes) {
                data.delimitedPrefixes.forEach(folder => {
                    const li = document.createElement('li');
                    li.className = 'file-item';
                    
                    // åªæ˜¾ç¤ºå½“å‰çº§çš„æ–‡ä»¶å¤¹åï¼Œå»æ‰çˆ¶è·¯å¾„å’Œæœ«å°¾æ–œæ 
                    const folderDisplayName = folder.replace(prefix, '').replace(/\/$/, '');
                    
                    li.innerHTML = `
                        <div class="file-info"><span class="file-name">ğŸ“ ${folderDisplayName}</span></div>
                        <div class="actions"><a href="?prefix=${encodeURIComponent(folder)}" class="btn btn-download">æ‰“å¼€</a></div>
                    `;
                    listElement.appendChild(li);
                });
            }

            // 3. æ¸²æŸ“æ–‡ä»¶ (æ¸…ç†å‰ç¼€)
            if (data.objects) {
                data.objects.forEach(file => {
                    if (file.key === prefix) return; // è¿‡æ»¤æ‰ç›®å½•å ä½ç¬¦è‡ªèº«

                    const li = document.createElement('li');
                    li.className = 'file-item';
                    const fileUrl = `${API_URL}/${encodeURIComponent(file.key)}`;
                    const isPdf = file.key.toLowerCase().endsWith('.pdf');

                    // âœ¨ å…³é”®æ”¹åŠ¨ï¼šåªæ˜¾ç¤ºæ–‡ä»¶åï¼Œå»æ‰å‰é¢çš„è·¯å¾„
                    // æ¯”å¦‚ä» "books/Operating Systems.pdf" å˜æˆ "Operating Systems.pdf"
                    const fileDisplayName = file.key.replace(prefix, '');

                    li.innerHTML = `
                        <div class="file-info">
                            <span class="file-name">ğŸ“„ ${fileDisplayName}</span>
                            <span class="file-size">${(file.size / 1024 / 1024).toFixed(2)} MB</span>
                        </div>
                        <div class="actions">
                            ${isPdf ? `<a href="${fileUrl}" target="_blank" class="btn btn-preview">é¢„è§ˆ</a>` : ''}
                            <a href="${fileUrl}" download class="btn btn-download">ä¸‹è½½</a>
                        </div>
                    `;
                    listElement.appendChild(li);
                });
            }

            if (listElement.innerHTML === '') {
                listElement.innerHTML = '<div class="loading">è¿™é‡Œç©ºç©ºå¦‚ä¹Ÿ...</div>';
            }

        } catch (error) {
            console.error(error);
            listElement.innerHTML = `<div class="loading" style="color: #ef4444;">âŒ åŠ è½½å¤±è´¥ï¼š${error.message}<br>è¯·æ£€æŸ¥ Worker ç»‘å®šåŠåŸŸåçŠ¶æ€</div>`;
        }
    }

    fetchFiles();
</script>

</body>
</html>