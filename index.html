<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>hhçš„å…±äº«æ–‡ä»¶</title>
    <style>
        :root { 
            --primary-color: #2563eb; 
            --bg-color: #f1f5f9; 
            --text-main: #334155;
            --text-muted: #64748b;
        }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg-color); margin: 0; padding: 15px; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 25px; border-radius: 16px; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }
        
        h1 { font-size: 1.5rem; color: #0f172a; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }

        /* é¢åŒ…å±‘å¯¼èˆªæ  */
        .breadcrumb {
            display: flex; flex-wrap: wrap; align-items: center; padding: 12px 16px; margin-bottom: 15px;
            background: #f8fafc; border-radius: 8px; font-size: 0.9rem; border: 1px solid #e2e8f0;
        }
        .breadcrumb-item { display: flex; align-items: center; }
        .breadcrumb-item + .breadcrumb-item::before { content: "â€º"; padding: 0 8px; color: #cbd5e1; font-size: 1.2rem; }
        .breadcrumb-item a { color: var(--primary-color); text-decoration: none; font-weight: 500; }
        .breadcrumb-item.active { color: var(--text-muted); }

        /* æœç´¢æ¡†æ ·å¼ */
        .search-box { margin-bottom: 20px; position: relative; }
        #search-input {
            width: 100%; padding: 12px 16px; border: 1px solid #e2e8f0; border-radius: 8px;
            font-size: 0.9rem; outline: none; transition: all 0.2s; box-sizing: border-box;
        }
        #search-input:focus { border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); }

        /* åˆ—è¡¨æ ·å¼ */
        .file-list { list-style: none; padding: 0; margin: 0; }
        .file-item { 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 14px; border-bottom: 1px solid #f1f5f9; border-radius: 8px; transition: 0.2s;
        }
        .file-item:hover { background: #f8fafc; transform: translateX(4px); }
        .file-info { display: flex; flex-direction: column; overflow: hidden; margin-right: 10px; }
        .file-name { font-weight: 500; color: var(--text-main); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .file-size { font-size: 0.75rem; color: #94a3b8; margin-top: 4px; }

        .actions { display: flex; gap: 10px; flex-shrink: 0; }
        .btn { padding: 6px 14px; border-radius: 8px; text-decoration: none; font-size: 0.85rem; font-weight: 600; border: 1px solid transparent; }
        .btn-preview { background: #ecfdf5; color: #059669; border-color: #10b981; }
        .btn-download { background: #eff6ff; color: #2563eb; border-color: #3b82f6; }
        .btn-folder { background: #fff7ed; color: #c2410c; border-color: #fb923c; }
        .loading { text-align: center; color: var(--text-muted); padding: 40px; }
    </style>
</head>
<body>

<div class="container">
    <h1 id="title">ğŸ“ æˆ‘çš„å…±äº«æ–‡ä»¶</h1>
    <ul id="file-list" class="file-list">
        <div class="loading">æ­£åœ¨æ‰«æä»“åº“ï¼Œè¯·ç¨å€™...</div>
    </ul>
</div>
<script>
    const API_DOMAIN = 'https://api.steveh1110.com';
    const NAS_DOMAIN = 'https://nas.steveh1110.com';

    async function fetchFiles() {
        const urlParams = new URLSearchParams(window.location.search);
        const prefix = urlParams.get('prefix') || '';
        const listElement = document.getElementById('file-list');
        const breadcrumbElement = document.getElementById('breadcrumb');
        const searchInput = document.getElementById('search-input');

        // æ¯æ¬¡è¿›å…¥æ–°ç›®å½•ï¼Œæ¸…ç©ºæœç´¢æ¡†
        searchInput.value = '';

        try {
            renderBreadcrumb(prefix, breadcrumbElement);

            const response = await fetch(`${API_DOMAIN}?prefix=${encodeURIComponent(prefix)}`);
            if (!response.ok) throw new Error('API è¯·æ±‚å¤±è´¥');
            
            const data = await response.json();
            listElement.innerHTML = '';

            // æ¸²æŸ“æ–‡ä»¶å¤¹
            if (data.delimitedPrefixes) {
                data.delimitedPrefixes.forEach(folder => {
                    const folderName = folder.split('/').filter(Boolean).pop();
                    const li = document.createElement('li');
                    li.className = 'file-item';
                    li.innerHTML = `
                        <div class="file-info"><span class="file-name">ğŸ“ ${folderName}</span></div>
                        <div class="actions"><a href="?prefix=${encodeURIComponent(folder)}" class="btn btn-folder">æ‰“å¼€</a></div>
                    `;
                    listElement.appendChild(li);
                });
            }

            // æ¸²æŸ“æ–‡ä»¶
            if (data.objects) {
                data.objects.forEach(file => {
                    if (file.key === prefix) return; 
                    const fileName = file.key.split('/').pop();
                    if (!fileName) return;

                    const isPdf = file.key.toLowerCase().endsWith('.pdf');
                    const previewUrl = `${API_DOMAIN}/${encodeURIComponent(file.key)}`;
                    const downloadUrl = `${NAS_DOMAIN}/${encodeURIComponent(file.key)}`;

                    const li = document.createElement('li');
                    li.className = 'file-item';
                    li.innerHTML = `
                        <div class="file-info">
                            <span class="file-name">ğŸ“„ ${fileName}</span>
                            <span class="file-size">${(file.size / 1024 / 1024).toFixed(2)} MB</span>
                        </div>
                        <div class="actions">
                            ${isPdf ? `<a href="${previewUrl}" target="_blank" class="btn btn-preview">é¢„è§ˆ</a>` : ''}
                            <a href="${downloadUrl}" download class="btn btn-download">ä¸‹è½½</a>
                        </div>
                    `;
                    listElement.appendChild(li);
                });
            }
        } catch (error) {
            listElement.innerHTML = `<div style="color:red; text-align:center; padding:20px;">åŠ è½½å¤±è´¥: ${error.message}</div>`;
        }
    }

    // å®æ—¶æœç´¢è¿‡æ»¤é€»è¾‘
    function filterFiles() {
        const term = document.getElementById('search-input').value.toLowerCase();
        const items = document.querySelectorAll('.file-item');
        items.forEach(item => {
            const name = item.querySelector('.file-name').innerText.toLowerCase();
            item.style.display = name.includes(term) ? 'flex' : 'none';
        });
    }

    function renderBreadcrumb(prefix, container) {
        container.innerHTML = '';
        const rootSpan = document.createElement('span');
        rootSpan.className = 'breadcrumb-item';
        rootSpan.innerHTML = `<a href="?prefix=">ğŸ  å…¨éƒ¨æ–‡ä»¶</a>`;
        container.appendChild(rootSpan);

        if (prefix) {
            const parts = prefix.split('/').filter(Boolean);
            let cumulativePath = '';
            parts.forEach((part, index) => {
                cumulativePath += part + '/';
                const span = document.createElement('span');
                span.className = 'breadcrumb-item';
                if (index === parts.length - 1) {
                    span.classList.add('active');
                    span.innerText = part;
                } else {
                    span.innerHTML = `<a href="?prefix=${encodeURIComponent(cumulativePath)}">${part}</a>`;
                }
                container.appendChild(span);
            });
        }
    }

    fetchFiles();
</script>
</body>
</html>