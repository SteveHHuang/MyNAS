<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>hhçš„å…±äº«æ–‡ä»¶</title>
    <style>
        :root { 
            --primary-color: #2563eb; 
            --bg-color: #f8fafc; 
            --card-bg: #ffffff;
            --text-main: #1e293b;
            --text-muted: #64748b;
            --border-color: #e2e8f0;
        }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg-color); margin: 0; padding: 20px; color: var(--text-main); }
        .container { max-width: 1000px; margin: 0 auto; }
        
        /* æ ‡é¢˜æ ·å¼ */
        h1 { font-size: 1.5rem; margin: 0 0 20px 5px; display: flex; align-items: center; gap: 10px; }

        /* --- åŠŸèƒ½åŒºå¸ƒå±€ (Top Section) --- */
        .function-area { 
            background: var(--card-bg); 
            padding: 20px; 
            border-radius: 12px; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }

        /* å¯¼èˆªæ§åˆ¶è¡Œï¼šç®­å¤´ + é¢åŒ…å±‘ */
        .nav-row { display: flex; align-items: center; gap: 12px; margin-bottom: 15px; }
        
        .nav-controls { display: flex; gap: 6px; }
        .nav-btn {
            width: 36px; height: 36px; display: flex; align-items: center; justify-content: center;
            background: white; border: 1px solid var(--border-color); border-radius: 8px;
            cursor: pointer; color: var(--text-muted); font-size: 1.2rem; transition: 0.2s;
        }
        .nav-btn:hover { border-color: var(--primary-color); color: var(--primary-color); background: #eff6ff; }

        .breadcrumb {
            flex: 1; display: flex; flex-wrap: wrap; align-items: center; padding: 0 16px;
            background: #f1f5f9; border-radius: 8px; font-size: 0.95rem; height: 36px;
        }
        .breadcrumb-item { display: flex; align-items: center; }
        .breadcrumb-item + .breadcrumb-item::before { content: "â€º"; padding: 0 8px; color: #cbd5e1; font-size: 1.2rem; }
        .breadcrumb-item a { color: var(--primary-color); text-decoration: none; font-weight: 500; }
        .breadcrumb-item.active { color: var(--text-muted); }

        /* æœç´¢æ¡†è¡Œ */
        .search-row { position: relative; }
        #search-input {
            width: 100%; padding: 12px 16px 12px 40px; border: 1px solid var(--border-color); border-radius: 8px;
            font-size: 0.95rem; outline: none; transition: 0.2s; box-sizing: border-box; background: #fff;
        }
        #search-input:focus { border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); }
        .search-icon { position: absolute; left: 14px; top: 50%; transform: translateY(-50%); color: var(--text-muted); }

        /* --- æ–‡ä»¶åˆ—è¡¨åŒº (List Section) --- */
        .file-list-container {
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border: 1px solid var(--border-color);
            overflow: hidden;
        }
        .file-list { list-style: none; padding: 0; margin: 0; }
        .file-item { 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 16px 20px; border-bottom: 1px solid #f1f5f9; transition: 0.2s;
        }
        .file-item:last-child { border-bottom: none; }
        .file-item:hover { background: #f8fafc; }
        
        .file-info { display: flex; flex-direction: column; overflow: hidden; margin-right: 15px; }
        .file-name { font-weight: 500; color: var(--text-main); font-size: 1rem; margin-bottom: 4px; }
        .file-meta { font-size: 0.8rem; color: var(--text-muted); }

        .actions { display: flex; gap: 8px; flex-shrink: 0; }
        .btn { padding: 7px 16px; border-radius: 6px; text-decoration: none; font-size: 0.85rem; font-weight: 600; border: 1px solid transparent; cursor: pointer; transition: 0.2s; }
        .btn-preview { background: #ecfdf5; color: #059669; border-color: #d1fae5; }
        .btn-preview:hover { background: #d1fae5; }
        .btn-download { background: #eff6ff; color: #2563eb; border-color: #dbeafe; }
        .btn-download:hover { background: #dbeafe; }
        .btn-folder { background: #fff7ed; color: #c2410c; border-color: #ffedd5; }
        .btn-folder:hover { background: #ffedd5; }

        .loading { text-align: center; color: var(--text-muted); padding: 50px; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ“ æˆ‘çš„å…±äº«æ–‡ä»¶</h1>
    
    <div class="function-area">
        <div class="nav-row">
            <div class="nav-controls">
                <button class="nav-btn" onclick="history.back()" title="åé€€">â†</button>
                <button class="nav-btn" onclick="history.forward()" title="å‰è¿›">â†’</button>
            </div>
            <nav id="breadcrumb" class="breadcrumb"></nav>
        </div>
        
        <div class="search-row">
            <span class="search-icon">ğŸ”</span>
            <input type="text" id="search-input" placeholder="åœ¨å½“å‰æ–‡ä»¶å¤¹ä¸­æœç´¢..." oninput="filterFiles()">
        </div>
    </div>

    <div class="file-list-container">
        <ul id="file-list" class="file-list">
            <div class="loading">æ­£åœ¨åŠªåŠ›åŠ è½½æ–‡ä»¶åˆ—è¡¨...</div>
        </ul>
    </div>
</div>

<script>
    // ä¿æŒä½ çš„åŸå§‹é…ç½®
    const API_DOMAIN = 'https://api.steveh1110.com';
    const NAS_DOMAIN = 'https://nas.steveh1110.com';

    async function fetchFiles() {
        const urlParams = new URLSearchParams(window.location.search);
        const prefix = urlParams.get('prefix') || '';
        const listElement = document.getElementById('file-list');
        const breadcrumbElement = document.getElementById('breadcrumb');
        const searchInput = document.getElementById('search-input');

        if (searchInput) searchInput.value = '';

        try {
            if (breadcrumbElement) renderBreadcrumb(prefix, breadcrumbElement);

            const response = await fetch(`${API_DOMAIN}?prefix=${encodeURIComponent(prefix)}`);
            if (!response.ok) throw new Error('æ— æ³•è¿æ¥åˆ° API æœåŠ¡');
            
            const data = await response.json();
            listElement.innerHTML = '';

            // æ¸²æŸ“æ–‡ä»¶å¤¹
            if (data.delimitedPrefixes) {
                data.delimitedPrefixes.forEach(folder => {
                    const folderName = folder.split('/').filter(Boolean).pop();
                    const li = document.createElement('li');
                    li.className = 'file-item';
                    li.innerHTML = `
                        <div class="file-info"><span class="file-name">ğŸ“ ${folderName}</span></div>
                        <div class="actions"><a href="?prefix=${encodeURIComponent(folder)}" class="btn btn-folder">æ‰“å¼€æ–‡ä»¶å¤¹</a></div>
                    `;
                    listElement.appendChild(li);
                });
            }

            // æ¸²æŸ“æ–‡ä»¶
            if (data.objects) {
                data.objects.forEach(file => {
                    if (file.key === prefix) return; 
                    const fileName = file.key.split('/').pop();
                    if (!fileName) return;

                    const isPdf = file.key.toLowerCase().endsWith('.pdf');
                    const previewUrl = `${API_DOMAIN}/${encodeURIComponent(file.key)}`;
                    const downloadUrl = `${NAS_DOMAIN}/${encodeURIComponent(file.key)}`;

                    const li = document.createElement('li');
                    li.className = 'file-item';
                    li.innerHTML = `
                        <div class="file-info">
                            <span class="file-name">ğŸ“„ ${fileName}</span>
                            <span class="file-meta">${(file.size / 1024 / 1024).toFixed(2)} MB</span>
                        </div>
                        <div class="actions">
                            ${isPdf ? `<a href="${previewUrl}" target="_blank" class="btn btn-preview">é¢„è§ˆ</a>` : ''}
                            <a href="${downloadUrl}" download class="btn btn-download">ä¸‹è½½</a>
                        </div>
                    `;
                    listElement.appendChild(li);
                });
            }
            
            if (listElement.innerHTML === '') {
                listElement.innerHTML = '<div class="loading">è¿™ä¸ªæ–‡ä»¶å¤¹æ˜¯ç©ºçš„</div>';
            }
        } catch (error) {
            listElement.innerHTML = `<div style="color:#ef4444; text-align:center; padding:30px;">âŒ åŠ è½½å¤±è´¥: ${error.message}</div>`;
        }
    }

    function filterFiles() {
        const term = document.getElementById('search-input').value.toLowerCase();
        const items = document.querySelectorAll('.file-item');
        items.forEach(item => {
            const name = item.querySelector('.file-name').innerText.toLowerCase();
            item.style.display = name.includes(term) ? 'flex' : 'none';
        });
    }

    function renderBreadcrumb(prefix, container) {
        container.innerHTML = '';
        const rootSpan = document.createElement('span');
        rootSpan.className = 'breadcrumb-item';
        rootSpan.innerHTML = `<a href="?prefix=">ğŸ  å…¨éƒ¨æ–‡ä»¶</a>`;
        container.appendChild(rootSpan);

        if (prefix) {
            const parts = prefix.split('/').filter(Boolean);
            let cumulativePath = '';
            parts.forEach((part, index) => {
                cumulativePath += part + '/';
                const span = document.createElement('span');
                span.className = 'breadcrumb-item';
                if (index === parts.length - 1) {
                    span.classList.add('active');
                    span.innerText = part;
                } else {
                    span.innerHTML = `<a href="?prefix=${encodeURIComponent(cumulativePath)}">${part}</a>`;
                }
                container.appendChild(span);
            });
        }
    }

    window.addEventListener('DOMContentLoaded', fetchFiles);
</script>
</body>
</html>